{% extends "layout.html" %}
{% block content %}

<div id="app" class="col-md-8 mx-auto">
    <form @submit.prevent="submitForm">
        <div v-for="(song, index) in user_songs" :key="index">
            <label>Artist:</label>
            <input type="text" v-model="song.artist" required>
            <label>Song Name:</label>
            <input type="text" v-model="song.name" required>
            <button v-if="index > 0" type="button" class="btn btn-outline-danger" @click="removeSong(index)"><i class="bi bi-dash-circle"></i></button>
        </div>
        <button type="button" class="btn btn-primary m-2" @click="addSong"><i class="bi bi-plus-circle mx-2"></i>Add Another Song</button>
        <br>
        <input type="submit" class="btn btn-primary m-2" value="Submit">
    </form>
</div>

<script type="module">

    import { createApp, ref } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'

    createApp({
        setup() {
            const user_songs = ref([{ artist: "Arctic Monkeys", name: "R U Mine?" }]);

            function addSong() {
                user_songs.value.push({ artist: "", name: "" });
            }

            function removeSong(index) {
                if (user_songs.value.length > 1) {
                    user_songs.value.splice(index, 1);
                }
            }

            function submitForm() {
                const songsJson = JSON.stringify(user_songs.value)

                fetch("{{url_for('main')}}", {
                    method: "POST",
                    body: songsJson,
                    headers: { "Content-Type": "application/json", }})
                    .then((response) => response.json()) // If expecting JSON response
                    .then((data) => { console.log(data); })
                    .catch((error) => {
                        console.error("Error:", error);
                    });
            }

            return {
                user_songs,
                addSong,
                removeSong,
                submitForm
            }
        }
    }).mount('#app')


</script>

{% endblock %}